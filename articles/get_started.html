<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="portvine">
<title>Get started • portvine</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Get started">
<meta property="og:description" content="portvine">
<meta property="og:image" content="https://emanuelsommer.github.io/portvine/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">portvine</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.2.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/parallel.html">Parallel processing</a>
    <a class="dropdown-item" href="../articles/theory.html">Under the hood</a>
    <a class="dropdown-item" href="../articles/get_started.html">Get started</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/EmanuelSommer/portvine/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Get started</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/EmanuelSommer/portvine/blob/HEAD/vignettes/get_started.Rmd" class="external-link"><code>vignettes/get_started.Rmd</code></a></small>
      <div class="d-none name"><code>get_started.Rmd</code></div>
    </div>

    
    
<p>In order to get up to speed with the <code>portvine</code> package
you will find in this vignette:</p>
<ul>
<li>
<strong>Exemplary workflows</strong> for the unconditional and
conditional risk measure estimation</li>
<li>
<strong>Opinionated visualization functions</strong> not included in
the package</li>
<li>Some notes on <strong>backtesting</strong> the estimated risk
measures</li>
</ul>
<p>What you do not find here is a theoretical description of the
algorithms. For this purpose there is the <strong>Under the hood
article</strong> on the package website and actually it is probably most
often the better idea to start off with the theoretical view. For a very
detailed theoretical view with lots of illustrations and two case
studies have a look at my thesis - <a href="https://mediatum.ub.tum.de/1658240" class="external-link">Sommer (2022)</a>.</p>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#################### required #################### </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/EmanuelSommer/portvine" class="external-link">portvine</a></span><span class="op">)</span></span>
<span><span class="co">#################### optional #################### </span></span>
<span><span class="co">## the following packages are only necessary for the visualizations</span></span>
<span><span class="co"># for visualization:</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">ggtext</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/ggtext/reference/element_markdown.html" class="external-link">element_markdown</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">11</span><span class="op">)</span>,</span>
<span>        plot.subtitle <span class="op">=</span> <span class="fu">ggtext</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/ggtext/reference/element_markdown.html" class="external-link">element_markdown</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">9</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># some data wrangling for visualizations</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span></code></pre></div>
<p>The sampling within the estimation algorithms is reproducible with a
fixed seed (this also holds for parallel processing).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="the-data-set">The data set<a class="anchor" aria-label="anchor" href="#the-data-set"></a>
</h2>
<p>With the package comes a small test data set containing 1000 daily
log returns of 3 stocks (Apple ~ AAPL, Alphabet ~ GOOG and Amazon ~
AMZN).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"sample_returns_small"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sample_returns_small</span><span class="op">)</span></span>
<span><span class="co">#&gt;            AAPL          GOOG         AMZN</span></span>
<span><span class="co">#&gt; 1:  0.005221515 -0.0063910288 -0.016940943</span></span>
<span><span class="co">#&gt; 2:  0.019702688  0.0232542613  0.016639145</span></span>
<span><span class="co">#&gt; 3:  0.019878308 -0.0006788564 -0.004209719</span></span>
<span><span class="co">#&gt; 4: -0.005595481  0.0065947671 -0.000176859</span></span>
<span><span class="co">#&gt; 5: -0.024806737 -0.0049333142  0.009580031</span></span>
<span><span class="co">#&gt; 6:  0.015416878  0.0113819042  0.018446965</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">sample_returns_small</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1000    3</span></span></code></pre></div>
<p>So as one financial year is comprised of roughly 250 days one has the
data of roughly 4 years. The aim is now to estimate portfolio level risk
measures for the last 40 days i.e. the interval <span class="math inline">\([960,1000]\)</span>. For a realistic scenario this
would of course be a very short window. First one specifies the marginal
assetwise time series models.</p>
</div>
<div class="section level2">
<h2 id="specify-marginal-models">Specify marginal models<a class="anchor" aria-label="anchor" href="#specify-marginal-models"></a>
</h2>
<p>In practice one would for example like to refit the marginal models
every two months which is in trading days roughly 50 days, but here we
will refit every 20 days. The training data size is already specified by
the interval of interest i.e. here one uses the whole available past of
the first marginal window which has the size 960.</p>
<div class="section level3">
<h3 id="the-unconditional-case">The unconditional case<a class="anchor" aria-label="anchor" href="#the-unconditional-case"></a>
</h3>
<p>Here in the unconditional case one will not deviate from the default
thus for all marginal models an ARMA(1,1)-GARCH(1,1) model is fitted.
The default model can be assessed via the function
<code><a href="../reference/default_garch_spec.html">default_garch_spec()</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/default_garch_spec.html">default_garch_spec</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; *---------------------------------*</span></span>
<span><span class="co">#&gt; *       GARCH Model Spec          *</span></span>
<span><span class="co">#&gt; *---------------------------------*</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Conditional Variance Dynamics    </span></span>
<span><span class="co">#&gt; ------------------------------------</span></span>
<span><span class="co">#&gt; GARCH Model      : sGARCH(1,1)</span></span>
<span><span class="co">#&gt; Variance Targeting   : FALSE </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Conditional Mean Dynamics</span></span>
<span><span class="co">#&gt; ------------------------------------</span></span>
<span><span class="co">#&gt; Mean Model       : ARFIMA(1,0,1)</span></span>
<span><span class="co">#&gt; Include Mean     : TRUE </span></span>
<span><span class="co">#&gt; GARCH-in-Mean        : FALSE </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Conditional Distribution</span></span>
<span><span class="co">#&gt; ------------------------------------</span></span>
<span><span class="co">#&gt; Distribution :  sstd </span></span>
<span><span class="co">#&gt; Includes Skew    :  TRUE </span></span>
<span><span class="co">#&gt; Includes Shape   :  TRUE </span></span>
<span><span class="co">#&gt; Includes Lambda  :  FALSE</span></span></code></pre></div>
<p>The marginal model specifications are then collected in a
<code>marginal_settings</code> object as shown below.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">uncond_marg_settings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/marginal_settings-class.html">marginal_settings</a></span><span class="op">(</span></span>
<span>  train_size <span class="op">=</span> <span class="fl">960</span>,</span>
<span>  refit_size <span class="op">=</span> <span class="fl">20</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="the-conditional-case">The conditional case<a class="anchor" aria-label="anchor" href="#the-conditional-case"></a>
</h3>
<p>For the conditional case one will use a more individual
specification. One changes the default to an ARMA(1,2)-GARCH(1,1) model
while sticking with the default for the Amazon stock.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cond_marg_settings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/marginal_settings-class.html">marginal_settings</a></span><span class="op">(</span></span>
<span>  train_size <span class="op">=</span> <span class="fl">960</span>,</span>
<span>  refit_size <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  individual_spec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"AMZN"</span> <span class="op">=</span> <span class="fu"><a href="../reference/default_garch_spec.html">default_garch_spec</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  default_spec <span class="op">=</span> <span class="fu"><a href="../reference/default_garch_spec.html">default_garch_spec</a></span><span class="op">(</span>ma <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The next step is to specify the settings for the vine fitting.</p>
</div>
</div>
<div class="section level2">
<h2 id="specify-vine-copula-models">Specify vine copula models<a class="anchor" aria-label="anchor" href="#specify-vine-copula-models"></a>
</h2>
<p>Here one would like to refit the vine copula models every 10 or 20
days which is allowed by the package as 20 is dividable by 10. One would
like to capture the dependence on a training set of 100 trading days for
each rolling window.</p>
<div class="section level3">
<h3 id="the-unconditional-case-1">The unconditional case<a class="anchor" aria-label="anchor" href="#the-unconditional-case-1"></a>
</h3>
<p>For the unconditional case one will use the default
<code>vine_type</code> which is the R-vine. For the bivariate building
blocks of the vine copula one will restrict oneself to the single
parametric pair copulas. For other possible choices have a look at the
help page of the function <code><a href="https://rdrr.io/pkg/rvinecopulib/man/bicop.html" class="external-link">rvinecopulib::bicop()</a></code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">uncond_vine_settings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vine_settings-class.html">vine_settings</a></span><span class="op">(</span></span>
<span>  train_size <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  refit_size <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  family_set <span class="op">=</span> <span class="st">"onepar"</span>, <span class="co"># valid bivariate building blocks</span></span>
<span>  vine_type <span class="op">=</span> <span class="st">"rvine"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="the-conditional-case-1">The conditional case<a class="anchor" aria-label="anchor" href="#the-conditional-case-1"></a>
</h3>
<p>In the conditional case up to now only D-vine copulas are allowed. As
copula families one will pick some arbitrary ones for this example. Note
that “parametric” would be the most nonrestrictive valid option
here.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cond_vine_settings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vine_settings-class.html">vine_settings</a></span><span class="op">(</span></span>
<span>  train_size <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  refit_size <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  family_set <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gumbel"</span>, <span class="st">"joe"</span>, <span class="st">"t"</span><span class="op">)</span>,</span>
<span>  vine_type <span class="op">=</span> <span class="st">"dvine"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Now one is ready to perform the actual risk measure estimation.</p>
</div>
</div>
<div class="section level2">
<h2 id="estimate-the-risk-measures">Estimate the risk measures<a class="anchor" aria-label="anchor" href="#estimate-the-risk-measures"></a>
</h2>
<p>The risk measures should be estimated at both popular confidence
levels 1% and 2.5%. In terms of risk measures one would like to estimate
the Value at Risk (VaR) and the expected shortfall (ES) with mean
estimation based on here a very small and not realistic sample size of
50. A realistic one would be 100000.</p>
<div class="section level3">
<h3 id="the-unconditional-case-2">The unconditional case<a class="anchor" aria-label="anchor" href="#the-unconditional-case-2"></a>
</h3>
<p>Here an equally weighted portfolio of the three stocks is assumed
thus one can leave the default <code>NULL</code>value for the
<code>weights</code> argument. The trace argument set to
<code>TRUE</code> will trigger the printing of some basic information
during training. This workhorse function of the package is very well
suited for parallel and even nested parallel processing. For details
have a look at the help page and consult the article covering the
parallel processing on the package website for some performance
measurements. Down below one can facilitate basic parallel processing by
just using the commented code.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## specify parallel strategy</span></span>
<span><span class="co"># future::plan("multisession", workers = 4)</span></span>
<span><span class="va">uncond_risk_roll</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_risk_roll.html">estimate_risk_roll</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">sample_returns_small</span>,</span>
<span>  weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  marginal_settings <span class="op">=</span> <span class="va">uncond_marg_settings</span>,</span>
<span>  vine_settings <span class="op">=</span> <span class="va">uncond_vine_settings</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.025</span><span class="op">)</span>,</span>
<span>  risk_measures <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"VaR"</span>, <span class="st">"ES_mean"</span><span class="op">)</span>,</span>
<span>  n_samples <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  trace <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fit marginal models:</span></span>
<span><span class="co">#&gt; AAPL  GOOG  AMZN  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fit vine copula models and estimate risk.</span></span>
<span><span class="co">#&gt; Vine windows:</span></span>
<span><span class="co">#&gt; (1/4) (2/4) (3/4) (4/4)</span></span>
<span><span class="co">## return to default sequential settings (cut off any background processes)</span></span>
<span><span class="co"># future::plan("sequential")</span></span></code></pre></div>
<p>Having estimated the risk measures one can get a short and more
detailed summary of the process by printing the object and calling the
summary method.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">uncond_risk_roll</span></span>
<span><span class="co">#&gt; An object of class &lt;portvine_roll&gt;</span></span>
<span><span class="co">#&gt; Number of ARMA-GARCH/ marginal windows: 2 </span></span>
<span><span class="co">#&gt; Number of vine windows: 4 </span></span>
<span><span class="co">#&gt; Risk measures estimated: VaR ES_mean </span></span>
<span><span class="co">#&gt; Alpha levels used: 0.01 0.025 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Time taken: 0.1557 minutes</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">uncond_risk_roll</span><span class="op">)</span></span>
<span><span class="co">#&gt; An object of class &lt;portvine_roll&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; --- Marginal models ---</span></span>
<span><span class="co">#&gt; Number of ARMA-GARCH/ marginal windows: 2 </span></span>
<span><span class="co">#&gt; Train size:  960 </span></span>
<span><span class="co">#&gt; Refit size:  20 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; --- Vine copula models ---</span></span>
<span><span class="co">#&gt; Number of vine windows: 4 </span></span>
<span><span class="co">#&gt; Train size:  100 </span></span>
<span><span class="co">#&gt; Refit size:  10 </span></span>
<span><span class="co">#&gt; Vine copula type:  rvine </span></span>
<span><span class="co">#&gt; Vine family set:  onepar </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; --- Risk estimation ---</span></span>
<span><span class="co">#&gt; Risk measures estimated: VaR ES_mean </span></span>
<span><span class="co">#&gt; Alpha levels used: 0.01 0.025 </span></span>
<span><span class="co">#&gt; Number of estimated risk measures: 160 </span></span>
<span><span class="co">#&gt; Number of samples for each risk estimation: 50 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Time taken: 0.1557 minutes.</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="the-conditional-case-2">The conditional case<a class="anchor" aria-label="anchor" href="#the-conditional-case-2"></a>
</h3>
<p>The package currently supports up to two conditioning assets. Here
the single conditional case will be covered but the double conditional
case is almost identical. One will choose the Amazon stock to be the
conditioning asset (via the <code>cond_vars</code> argument).
Furthermore one will give the Alphabet stock a greater weight and the
weight of the conditioning asset must of course be zero. Note that the
weights for example according to market capitalization can be even
changing on the vine window granularity level. The <code>cond_u</code>
argument then specifies the quantile level of the conditioning value. So
a small quantile level will emulate the behavior of a very weak
performance of the conditioning Amazon stock. Details on all arguments
are given on the help page.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cond_risk_roll</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_risk_roll.html">estimate_risk_roll</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">sample_returns_small</span>,</span>
<span>  weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AAPL"</span> <span class="op">=</span> <span class="fl">1</span>, <span class="st">"GOOG"</span> <span class="op">=</span> <span class="fl">2</span>, <span class="st">"AMZN"</span> <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>  marginal_settings <span class="op">=</span> <span class="va">cond_marg_settings</span>,</span>
<span>  vine_settings <span class="op">=</span> <span class="va">cond_vine_settings</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.025</span><span class="op">)</span>,</span>
<span>  risk_measures <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"VaR"</span>, <span class="st">"ES_mean"</span><span class="op">)</span>,</span>
<span>  n_samples <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  cond_vars <span class="op">=</span> <span class="st">"AMZN"</span>,</span>
<span>  cond_u <span class="op">=</span> <span class="fl">0.1</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Having estimated the conditional risk measures one can again get a
short and more detailed summary of the process by printing the object
and calling the summary method.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cond_risk_roll</span></span>
<span><span class="co">#&gt; An object of class &lt;cond_portvine_roll&gt;</span></span>
<span><span class="co">#&gt; Conditional variable(s): AMZN </span></span>
<span><span class="co">#&gt; Number of ARMA-GARCH/ marginal windows: 2 </span></span>
<span><span class="co">#&gt; Number of vine windows: 2 </span></span>
<span><span class="co">#&gt; Risk measures estimated: VaR ES_mean </span></span>
<span><span class="co">#&gt; Alpha levels used: 0.01 0.025 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Time taken: 0.1596 minutes</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cond_risk_roll</span><span class="op">)</span></span>
<span><span class="co">#&gt; An object of class &lt;cond_portvine_roll&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; --- Conditional settings ---</span></span>
<span><span class="co">#&gt; Conditional variable(s): AMZN </span></span>
<span><span class="co">#&gt; Number of conditional estimated risk measures: 320 </span></span>
<span><span class="co">#&gt; Conditioning quantiles: 0.1 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; --- Marginal models ---</span></span>
<span><span class="co">#&gt; Number of ARMA-GARCH/ marginal windows: 2 </span></span>
<span><span class="co">#&gt; Train size:  960 </span></span>
<span><span class="co">#&gt; Refit size:  20 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; --- Vine copula models ---</span></span>
<span><span class="co">#&gt; Number of vine windows: 2 </span></span>
<span><span class="co">#&gt; Train size:  100 </span></span>
<span><span class="co">#&gt; Refit size:  20 </span></span>
<span><span class="co">#&gt; Vine copula type:  dvine </span></span>
<span><span class="co">#&gt; Vine family set:  gumbel joe t </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; --- Risk estimation ---</span></span>
<span><span class="co">#&gt; Risk measures estimated: VaR ES_mean </span></span>
<span><span class="co">#&gt; Alpha levels used: 0.01 0.025 </span></span>
<span><span class="co">#&gt; Number of estimated risk measures: 160 </span></span>
<span><span class="co">#&gt; Number of samples for each risk estimation: 50 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Time taken: 0.1596 minutes.</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="assess-marginal-model-quality">Assess marginal model quality<a class="anchor" aria-label="anchor" href="#assess-marginal-model-quality"></a>
</h2>
<p>In order to extract the marginal models one can use the function
<code><a href="../reference/fitted_marginals.html">fitted_marginals()</a></code>. The result is a named list with a
<code><a href="https://rdrr.io/pkg/rugarch/man/ugarchroll-methods.html" class="external-link">rugarch::ugarchroll</a></code> object for each asset. These objects
contain all fitted marginal time series models.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="../reference/fitted_marginals.html">fitted_marginals</a></span><span class="op">(</span><span class="va">uncond_risk_roll</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "AAPL" "GOOG" "AMZN"</span></span></code></pre></div>
<p>For the extraction of the fitted residuals for a residual analysis
the <code>portvine</code> package further provides the utility function
<code><a href="../reference/roll_residuals.html">roll_residuals()</a></code>. In the following an opinionated
visualization function useful for a visual residual analysis is given
and used. It allows to visualize the raw standardized residuals, the
empirical autocorrelation function of them and the results (p-values) of
Ljung-Box tests for serial correlation at different lags. This is useful
to assess the appropriateness of the mean equation of the ARMA-GARCH
model. In order to assess the volatility equation one can have a look at
the same visualization for the squared standardized residuals. As the
function is highly opinionated it was not integrated in the
<code>portvine</code> package.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># An opinionated function for residual analysis. Note this function has no </span></span>
<span><span class="co"># input checks and is not tested in any ways.</span></span>
<span><span class="co"># Output: named list with a composition of residual plots for each asset</span></span>
<span><span class="va">marg_resid_viz_list</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span></span>
<span>  <span class="va">roll</span>, <span class="co"># portvine_roll or cond_portvine_roll object</span></span>
<span>  <span class="va">asset_names</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="co"># filter for certain  assets</span></span>
<span>  <span class="va">marg_window</span> <span class="op">=</span> <span class="fl">1</span>, <span class="co"># specify a marginal window</span></span>
<span>  <span class="va">squared</span> <span class="op">=</span> <span class="cn">FALSE</span> <span class="co"># if set to true the results for the squared stand. residuals</span></span>
<span>  <span class="co"># are displayed</span></span>
<span>  <span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">fitted_marginals</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitted_marginals.html">fitted_marginals</a></span><span class="op">(</span><span class="va">roll</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">asset_names</span><span class="op">)</span><span class="op">)</span> <span class="va">asset_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitted_vines.html">fitted_vines</a></span><span class="op">(</span><span class="va">roll</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">names</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span></span>
<span>    <span class="va">asset_names</span>,</span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">asset_name</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="co"># use again a utility function from the portvine package to extract the </span></span>
<span>      <span class="co"># fitted standardized residuals</span></span>
<span>      <span class="va">model_resid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/roll_residuals.html">roll_residuals</a></span><span class="op">(</span></span>
<span>        <span class="va">fitted_marginals</span><span class="op">[[</span><span class="va">asset_name</span><span class="op">]</span><span class="op">]</span>, <span class="va">marg_window</span></span>
<span>      <span class="op">)</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="va">squared</span><span class="op">)</span> <span class="va">model_resid</span> <span class="op">&lt;-</span> <span class="va">model_resid</span><span class="op">^</span><span class="fl">2</span></span>
<span></span>
<span>      <span class="va">simple_exploratory</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>resid <span class="op">=</span> <span class="va">model_resid</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">model_resid</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">id</span>, y <span class="op">=</span> <span class="va">resid</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"t"</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">squared</span>, <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">z</span><span class="op">[</span><span class="va">t</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">z</span><span class="op">[</span><span class="va">t</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             title <span class="op">=</span> <span class="va">asset_name</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>              axis.ticks.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>      <span class="va">acf_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>        acf <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/acf.html" class="external-link">acf</a></span><span class="op">(</span><span class="va">model_resid</span>, type <span class="op">=</span> <span class="st">"cor"</span>, lag.max <span class="op">=</span> <span class="fl">20</span>,</span>
<span>                             plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">acf</span><span class="op">)</span>,</span>
<span>        lag <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">20</span></span>
<span>      <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">lag</span> <span class="op">!=</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">lag</span> <span class="op">&lt;=</span> <span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span></span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">model_resid</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                   linetype <span class="op">=</span> <span class="st">"longdash"</span>, col <span class="op">=</span> <span class="st">"#92B8DE"</span>, size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html" class="external-link">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lag</span>, xend <span class="op">=</span> <span class="va">lag</span>, y <span class="op">=</span> <span class="fl">0</span>, yend <span class="op">=</span> <span class="va">acf</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lag</span>, y <span class="op">=</span> <span class="va">acf</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"h"</span>, y <span class="op">=</span> <span class="st">"ACF(h)"</span><span class="op">)</span></span>
<span></span>
<span>      <span class="va">ljungplot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>        pval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span></span>
<span>          <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,</span>
<span>          <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/box.test.html" class="external-link">Box.test</a></span><span class="op">(</span><span class="va">model_resid</span>, lag <span class="op">=</span> <span class="va">i</span>,</span>
<span>                               type <span class="op">=</span> <span class="st">"Lju"</span><span class="op">)</span><span class="op">$</span><span class="va">p.value</span><span class="op">)</span>,</span>
<span>        lag <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>                   linetype <span class="op">=</span> <span class="st">"longdash"</span>, col <span class="op">=</span> <span class="st">"#92B8DE"</span>, size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lag</span>, y <span class="op">=</span> <span class="va">pval</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lag</span>, y <span class="op">=</span> <span class="va">pval</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"h"</span>, y <span class="op">=</span> <span class="st">"p-value of Ljung-Box test at lag h"</span><span class="op">)</span></span>
<span></span>
<span>      <span class="op">(</span><span class="va">simple_exploratory</span> <span class="op">/</span> <span class="op">(</span><span class="va">ljungplot</span> <span class="op">+</span> <span class="va">acf_plot</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="op">}</span>, USE.NAMES <span class="op">=</span> <span class="cn">TRUE</span>, simplify <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Apply the function to the result of the unconditional estimation and
display the residual plots for Apple and Alphabet.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">uncond_residual_viz</span> <span class="op">&lt;-</span> <span class="fu">marg_resid_viz_list</span><span class="op">(</span><span class="va">uncond_risk_roll</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use `linewidth` instead.</span></span>
<span><span class="va">uncond_residual_viz_squared</span> <span class="op">&lt;-</span> <span class="fu">marg_resid_viz_list</span><span class="op">(</span></span>
<span>  <span class="va">uncond_risk_roll</span>, squared <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">uncond_residual_viz</span><span class="op">$</span><span class="va">AAPL</span></span></code></pre></div>
<p><img src="get_started_files/figure-html/unnamed-chunk-18-1.png" width="672"></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">uncond_residual_viz_squared</span><span class="op">$</span><span class="va">GOOG</span></span></code></pre></div>
<p><img src="get_started_files/figure-html/unnamed-chunk-18-2.png" width="672"></p>
<p>For a better overview of all assets, especially in higher dimensions,
a heatmap with the p-values of the Ljung-Box tests can be useful. For
this I will now showcase another opinionated utility function.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The function creates a heatmap of Ljung Box test p-values for a </span></span>
<span><span class="co"># (cond-)portvine_roll object. Note this function again has no </span></span>
<span><span class="co"># input checks and is not tested in any ways.</span></span>
<span><span class="co"># Output: The heatmap (ggplot2 object)</span></span>
<span><span class="va">ljung_heatmap</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">roll</span>, <span class="va">roll_num</span> <span class="op">=</span> <span class="fl">1</span>, <span class="va">squared</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">asset_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitted_vines.html">fitted_vines</a></span><span class="op">(</span><span class="va">roll</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">names</span></span>
<span>  <span class="va">roll_marginals</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitted_marginals.html">fitted_marginals</a></span><span class="op">(</span><span class="va">roll</span><span class="op">)</span></span>
<span>  <span class="va">ljung_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">asset_names</span>, <span class="kw">function</span><span class="op">(</span><span class="va">asset_name</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">model_resid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/roll_residuals.html">roll_residuals</a></span><span class="op">(</span></span>
<span>      <span class="va">roll_marginals</span><span class="op">[[</span><span class="va">asset_name</span><span class="op">]</span><span class="op">]</span>, roll_num <span class="op">=</span> <span class="va">roll_num</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">squared</span><span class="op">)</span> <span class="va">model_resid</span> <span class="op">&lt;-</span> <span class="va">model_resid</span><span class="op">^</span><span class="fl">2</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span></span>
<span>      <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,</span>
<span>      <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/box.test.html" class="external-link">Box.test</a></span><span class="op">(</span><span class="va">model_resid</span>, lag <span class="op">=</span> <span class="va">i</span>, type <span class="op">=</span> <span class="st">"Lju"</span><span class="op">)</span><span class="op">$</span><span class="va">p.value</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span>, USE.NAMES <span class="op">=</span> <span class="cn">TRUE</span>, simplify <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">ljung_data</span> <span class="op">&lt;-</span> <span class="va">ljung_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>lag <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ljung_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="op">-</span><span class="va">lag</span>, names_to <span class="op">=</span> <span class="st">"asset"</span>, values_to <span class="op">=</span> <span class="st">"pval"</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">ljung_data</span><span class="op">$</span><span class="va">pval</span> <span class="op">&gt;=</span> <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">legend_scale</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient</a></span><span class="op">(</span></span>
<span>      low <span class="op">=</span> <span class="st">"#92B8DE"</span>, high <span class="op">=</span> <span class="st">"#2a82db"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">legend_scale</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradientn</a></span><span class="op">(</span></span>
<span>      colours <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#db4f59"</span>,<span class="st">"#C37285"</span> ,</span>
<span>                  <span class="st">"#92B8DE"</span>, <span class="st">"#2a82db"</span><span class="op">)</span>,</span>
<span>      values <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/rescale.html" class="external-link">rescale</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.05</span> <span class="op">-</span> <span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span><span class="op">)</span>,</span>
<span>      labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span><span class="op">)</span>,</span>
<span>      guide <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_colourbar.html" class="external-link">guide_colourbar</a></span><span class="op">(</span>nbin <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">ljung_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lag</span>, y <span class="op">=</span> <span class="va">asset</span>, fill <span class="op">=</span> <span class="va">pval</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">""</span>, x <span class="op">=</span> <span class="st">"h"</span>, fill <span class="op">=</span> <span class="st">"p-value"</span>,</span>
<span>         title <span class="op">=</span> <span class="st">"Results of the Ljung-Box tests"</span>,</span>
<span>         caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Rolling window:"</span>, <span class="va">roll_num</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="va">legend_scale</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span>,</span>
<span>          panel.grid.minor.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>This time one uses the result of the conditional risk measure
estimation for a display of the function for the residual analysis.
<span class="math inline">\(h\)</span> again denotes the lag.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ljung_heatmap</span><span class="op">(</span><span class="va">uncond_risk_roll</span><span class="op">)</span></span></code></pre></div>
<p><img src="get_started_files/figure-html/unnamed-chunk-20-1.png" width="672"></p>
<p>P-values lower than 0.05 would be highlighted in red on the heatmap
for easy spotting.</p>
</div>
<div class="section level2">
<h2 id="a-look-at-the-fitted-vine-copulas">A look at the fitted vine copulas<a class="anchor" aria-label="anchor" href="#a-look-at-the-fitted-vine-copulas"></a>
</h2>
<p>Next up one can have a look at the fitted vine copulas. For this
again a utility function is available in the <code>portvine</code>
package. The function <code><a href="../reference/fitted_vines.html">fitted_vines()</a></code> extracts all fitted
vines in a list, one vine copula object for each vine window.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">uncond_fitted_vines</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitted_vines.html">fitted_vines</a></span><span class="op">(</span><span class="va">uncond_risk_roll</span><span class="op">)</span></span>
<span><span class="va">uncond_fitted_vines</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; 3-dimensional vine copula fit ('vinecop')</span></span>
<span><span class="co">#&gt; nobs = 100   logLik = 56   npars = 3   AIC = -106   BIC = -98.19</span></span></code></pre></div>
<p>As the list elements are <code><a href="https://rdrr.io/pkg/rvinecopulib/man/vinecop.html" class="external-link">rvinecopulib::vinecop</a></code> objects
one can further analyze them with tools from the great <a href="https://vinecopulib.github.io/rvinecopulib/" class="external-link"><code>rvinecopulib</code></a>
package e.g. plot the objects to exploit the graphical representation,
which aids interpretability.</p>
</div>
<div class="section level2">
<h2 id="analyze-the-risk-measure-estimates">Analyze the risk measure estimates<a class="anchor" aria-label="anchor" href="#analyze-the-risk-measure-estimates"></a>
</h2>
<p>The last utility function that is presented in this vignette is
<code><a href="../reference/risk_estimates.html">risk_estimates()</a></code> and as the name suggests it can be used to
easily extract the risk measure estimates from the estimation result
object. One can not only filter by the risk measure, confidence levels
but also choose between an output as <code>data.frame</code> or
<code>data.table</code>. Moreover optionally it calculates a logical
column indicating whether the risk measure was exceeded.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## a glimpse at the tidy data.frame with all estimated risk measures</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/risk_estimates.html">risk_estimates</a></span><span class="op">(</span><span class="va">uncond_risk_roll</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;    risk_measure    risk_est alpha row_num vine_window     realized</span></span>
<span><span class="co">#&gt; 1           VaR -0.06188025 0.010     961           1 -0.001246766</span></span>
<span><span class="co">#&gt; 2           VaR -0.04601638 0.025     961           1 -0.001246766</span></span>
<span><span class="co">#&gt; 3       ES_mean -0.07602761 0.010     961           1 -0.001246766</span></span>
<span><span class="co">#&gt; 4       ES_mean -0.06159152 0.025     961           1 -0.001246766</span></span>
<span><span class="co">#&gt; 5           VaR -0.08681665 0.010     962           1  0.048242745</span></span>
<span><span class="co">#&gt; 6           VaR -0.04667800 0.025     962           1  0.048242745</span></span>
<span><span class="co">#&gt; 7       ES_mean -0.12238695 0.010     962           1  0.048242745</span></span>
<span><span class="co">#&gt; 8       ES_mean -0.08609073 0.025     962           1  0.048242745</span></span>
<span><span class="co">#&gt; 9           VaR -0.06523401 0.010     963           1  0.011817887</span></span>
<span><span class="co">#&gt; 10          VaR -0.05740317 0.025     963           1  0.011817887</span></span>
<span></span>
<span><span class="co">## a glimpse at the estimated VaR at confidence level 1% with exceeded column</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/risk_estimates.html">risk_estimates</a></span><span class="op">(</span></span>
<span>    <span class="va">uncond_risk_roll</span>,</span>
<span>    risk_measures <span class="op">=</span> <span class="st">"VaR"</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>    exceeded <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fl">6</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;   risk_measure    risk_est alpha row_num vine_window     realized exceeded</span></span>
<span><span class="co">#&gt; 1          VaR -0.06188025  0.01     961           1 -0.001246766    FALSE</span></span>
<span><span class="co">#&gt; 2          VaR -0.08681665  0.01     962           1  0.048242745    FALSE</span></span>
<span><span class="co">#&gt; 3          VaR -0.06523401  0.01     963           1  0.011817887    FALSE</span></span>
<span><span class="co">#&gt; 4          VaR -0.07158635  0.01     964           1  0.012662108    FALSE</span></span>
<span><span class="co">#&gt; 5          VaR -0.09355120  0.01     965           1  0.023044956    FALSE</span></span>
<span><span class="co">#&gt; 6          VaR -0.16243081  0.01     966           1 -0.013655480    FALSE</span></span>
<span></span>
<span><span class="co">## of course also applies for the conditional case</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/risk_estimates.html">risk_estimates</a></span><span class="op">(</span></span>
<span>    <span class="va">cond_risk_roll</span>,</span>
<span>    risk_measures <span class="op">=</span> <span class="st">"ES_mean"</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>    cond_u <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"resid"</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fl">6</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;   risk_measure    risk_est alpha row_num         AMZN cond_u vine_window</span></span>
<span><span class="co">#&gt; 1      ES_mean -0.10061696  0.01     961 -0.021713172    0.1           1</span></span>
<span><span class="co">#&gt; 2      ES_mean -0.04510164  0.01     961 -0.008608346  resid           1</span></span>
<span><span class="co">#&gt; 3      ES_mean -0.15587622  0.01     962 -0.019582204    0.1           1</span></span>
<span><span class="co">#&gt; 4      ES_mean -0.03063455  0.01     962  0.015758643  resid           1</span></span>
<span><span class="co">#&gt; 5      ES_mean -0.11188717  0.01     963 -0.019476899    0.1           1</span></span>
<span><span class="co">#&gt; 6      ES_mean -0.02746862  0.01     963  0.008117431  resid           1</span></span>
<span><span class="co">#&gt;       realized</span></span>
<span><span class="co">#&gt; 1  0.007439544</span></span>
<span><span class="co">#&gt; 2  0.007439544</span></span>
<span><span class="co">#&gt; 3  0.039189494</span></span>
<span><span class="co">#&gt; 4  0.039189494</span></span>
<span><span class="co">#&gt; 5 -0.002692899</span></span>
<span><span class="co">#&gt; 6 -0.002692899</span></span></code></pre></div>
<p>This tidy representation can be easily used for visualizations. For
example comparisons of risk measures over time.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/risk_estimates.html">risk_estimates</a></span><span class="op">(</span><span class="va">uncond_risk_roll</span>, alpha <span class="op">=</span> <span class="fl">0.025</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">row_num</span>, y <span class="op">=</span> <span class="va">realized</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">row_num</span>, y <span class="op">=</span> <span class="va">risk_est</span>,</span>
<span>                col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">risk_measure</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#92B8DE"</span>, <span class="st">"#477042"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"trading day"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"portfolio log returns"</span>,</span>
<span>       col <span class="op">=</span> <span class="st">"Risk measure"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Comparison of unconditional risk measure estimates at </span></span>
<span><span class="st">       confidence level 2.5%"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Realized log returns in "</span>,</span>
<span>                     <span class="st">"&lt;span style='color:"</span>,</span>
<span>                     <span class="st">"grey"</span>,</span>
<span>                     <span class="st">"'&gt;**grey**&lt;/span&gt;"</span>,</span>
<span>                     <span class="st">"."</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="get_started_files/figure-html/unnamed-chunk-23-1.png" width="672"></p>
<p>Or one can explore exceedances.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/risk_estimates.html">risk_estimates</a></span><span class="op">(</span></span>
<span>  <span class="va">uncond_risk_roll</span>,</span>
<span>  risk_measures <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"VaR"</span><span class="op">)</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  exceeded <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">row_num</span>, y <span class="op">=</span> <span class="va">realized</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"lightgrey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">row_num</span>, y <span class="op">=</span> <span class="va">risk_est</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"#92B8DE"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">row_num</span>, y <span class="op">=</span> <span class="va">realized</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"#db4f59"</span>, </span>
<span>             inherit.aes <span class="op">=</span> <span class="cn">FALSE</span>, data <span class="op">=</span> <span class="va">.</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">exceeded</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"trading days"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"portfolio log returns"</span>,</span>
<span>       col <span class="op">=</span> <span class="st">"Exceeded"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Exceedances are highlighted in "</span>,</span>
<span>                     <span class="st">"&lt;span style='color:"</span>,</span>
<span>                     <span class="st">"#db4f59"</span>,</span>
<span>                     <span class="st">"'&gt;**red**&lt;/span&gt;"</span>,</span>
<span>                     <span class="st">"."</span><span class="op">)</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Risk measure: VaR with confidence level 1%"</span></span>
<span>       <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<p><img src="get_started_files/figure-html/unnamed-chunk-24-1.png" width="672"></p>
<p>In the conditional case one can first have a look at how the
different conditional strategies behave. On the one side a conditioning
value based on the quantile level 0.1 was forecasted (below shown in
light blue) and on the other side the residual strategy is by default
set to the one that uses the realized residuals (below shown in green,
it should almost overlay the grey realized line). Those are only for the
comparison as they conceptually are an oracle as the actual realized
conditional asset returns would not be known at sampling time.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/risk_estimates.html">risk_estimates</a></span><span class="op">(</span></span>
<span>  <span class="va">cond_risk_roll</span>,</span>
<span>  risk_measures <span class="op">=</span> <span class="st">"ES_mean"</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">sample_returns_small</span><span class="op">[</span><span class="fl">961</span><span class="op">:</span><span class="fl">1000</span>, <span class="st">"AMZN"</span><span class="op">]</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">961</span><span class="op">:</span><span class="fl">1000</span>,</span>
<span>        y <span class="op">=</span> <span class="va">AMZN</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"grey"</span>, size <span class="op">=</span> <span class="fl">.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">row_num</span>, y <span class="op">=</span> <span class="va">AMZN</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">cond_u</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#92B8DE"</span>, <span class="st">"#477042"</span><span class="op">)</span>,</span>
<span>                     name <span class="op">=</span> <span class="st">"Conditional strategy"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Conditional variable: AMZN"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"trading days"</span>, y <span class="op">=</span> <span class="st">"log returns of the asset AMZN"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Realized log returns in "</span>,</span>
<span>                     <span class="st">"&lt;span style='color:"</span>,</span>
<span>                     <span class="st">"grey"</span>,</span>
<span>                     <span class="st">"'&gt;**grey**&lt;/span&gt;"</span>,</span>
<span>                     <span class="st">"."</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="get_started_files/figure-html/unnamed-chunk-25-1.png" width="672"></p>
<p>Then one can compare the resulting conditional risk measure
estimates.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/risk_estimates.html">risk_estimates</a></span><span class="op">(</span><span class="va">cond_risk_roll</span>, alpha <span class="op">=</span> <span class="fl">0.025</span>, risk_measures <span class="op">=</span> <span class="st">"ES_mean"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">row_num</span>, y <span class="op">=</span> <span class="va">realized</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">row_num</span>, y <span class="op">=</span> <span class="va">risk_est</span>,</span>
<span>                col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">cond_u</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#477042"</span>, <span class="st">"#92B8DE"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"trading day"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"portfolio log returns"</span>,</span>
<span>       col <span class="op">=</span> <span class="st">"Conditional strategy"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Comparison of conditional risk measure estimates at </span></span>
<span><span class="st">       confidence level 2.5%"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Realized log returns in "</span>,</span>
<span>                     <span class="st">"&lt;span style='color:"</span>,</span>
<span>                     <span class="st">"grey"</span>,</span>
<span>                     <span class="st">"'&gt;**grey**&lt;/span&gt;"</span>,</span>
<span>                     <span class="st">"."</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="get_started_files/figure-html/unnamed-chunk-26-1.png" width="672"></p>
<p>This is of course just the tip of the iceberg and countless other
visualizations are possible at that point. Especially for multiple
conditional quantile levels in a stress testing scenario. An especially
promising comparison is the one comparing multiple levels of quantile
based risk measure estimates with the respective unconditional one. This
allows to assess how well the unconditional approach accounts for the
market risk on the portfolio associated with fluctuations of the
conditional asset(s).</p>
<p>The interpretation is left out for these exemplary workflows.
Detailed case studies can again be found in <a href="https://mediatum.ub.tum.de/1658240" class="external-link">Sommer (2022)</a>.</p>
</div>
<div class="section level2">
<h2 id="backtesting-the-estimated-risk-measures">Backtesting the estimated risk measures<a class="anchor" aria-label="anchor" href="#backtesting-the-estimated-risk-measures"></a>
</h2>
<p>The risk measure estimation performed is in many cases performed with
the goal of backtesting in mind. This can be easily achieved given the
objects returned by the <code><a href="../reference/estimate_risk_roll.html">estimate_risk_roll()</a></code> function. As
there are already excellent resources for performing these here are some
suggestions for implementations that can be applied in this portfolio
level setting:</p>
<ul>
<li>
<strong>Value at Risk backtesting</strong>: The package <a href="https://CRAN.R-project.org/package=rugarch" class="external-link"><code>rugarch</code></a>
contains the straightforward to use function
<code><a href="https://rdrr.io/pkg/rugarch/man/VaRTest.html" class="external-link">rugarch::VaRTest()</a></code>. It features classical backtests based
on violation sequences.</li>
<li>
<strong>Expected shortfall backtesting</strong>: The package <a href="https://CRAN.R-project.org/package=esback" class="external-link"><code>esback</code></a>
contains a suite of easy to use and theoretically backed backtests for
the expected shortfall.</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Emanuel Sommer.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
